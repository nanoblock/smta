<div class="profile">
  <div class="container">

    <div class="profile-container"> 
      <% unless @profile.nil? %>
        <div class="info">
        <!--  -->
          <%= image_tag asset_path(@profile.avatar.url), class: 'user-icon' %>
          <div class="user-profile">
            <div class="text">
                <%= @profile.app_name %>
            </div>
            <div class="action-icon">
              <%= link_to image_tag(asset_path('profile/call.svg'), class: 'icon'), "tel:"+@profile.tel %>
              <%= mail_to @profile.app_email, image_tag(asset_path('profile/mail.svg'), class: 'icon') %>
              <%= image_tag asset_path('profile/edit.svg'), class: 'icon', id: 'edit' %>
            </div>
            <div class="sub-text">
              <%= @profile.desc %>
            </div>
          </div>
        </div>

        <div class="edit-info">
          <%= render 'profile/form' %>
        </div>
      <% end %>

      <% @projects.each_with_index do |project, index| %>
        <div class="content content-<%= index %>">
          <%= link_to image_tag(asset_path('profile/edit.svg'), class: 'edit-icon'), show_project_path(project.name) %>
          <!-- <= image_tag asset_path('profile/edit.svg'), class: 'edit-icon' %> -->
            <div class="content-container">
              <div class="title"><%= project.name %></div>
              <div class="desc"><%= project.desc %></div>

              <% unless project.images.empty? %>
                <%= image_tag asset_path(project.images.first.photo(:thumb)) %>
                <% if @browser != 'phone'%>
                  <% unless project.images.second.nil? %>
                    <%= image_tag asset_path(project.images.second.photo(:thumb)), style: 'margin-left:5px;', class: "delete-target-img" %>
                  <% end %>
                <% end %>
              <% else %>
                <%= link_to image_tag(asset_path('project/image_upload.svg'), class: 'default_img'), show_project_path(project.name) %>
              <% end %>

            </div>
        </div>
      <% end %>

    </div>

    <% case params[:page] 
      when "1", nil, @last_page.to_s %>
        <%= paginate @projects, window: 4 %>
      <% when "2", (@last_page-1).to_s %>
        <%= paginate @projects, window: 3 %>
      <% else %>
        <%= paginate @projects, window: 2 %>
    <% end %>

</div>
</div>
<script>
  $('.content').css('top',$('.info').height()+20+"px");

  deleteTargetImg($(document).width());
  
  $(window).resize(function(e) {
    deleteTargetImg($(this).width());
  });

  $('.action-icon #edit').on('click', function(e) {
    showEditInfo($(document).width());
  });

  $('.action-icon .cancel').on('click', function(e) {
    showInfo($(document).width());
  });

  $('.action-icon .submit').on('click', function(e) {
    param_app_name = $('.edit-name-form input').val();
    param_desc = $('.edit-desc-form textarea').val();
    param_tel = $('.edit-tel-form input').val();
    param_app_email = $('.edit-email-form input').val();

    if (!isNullOrUndefined(param_app_name) && !isNullOrUndefined(param_desc) && !isNullOrUndefined(param_tel) && !isNullOrUndefined(param_app_email)){

      $.ajax({
        type: "PUT",
        url: "<%= profile_path %>",
        data: { profile: { 
          app_name: param_app_name, 
          desc: param_desc, 
          tel: param_tel, 
          app_email: param_app_email}
        },
        success: function(data) {
          if($('.edit-info').css('display') != 'none') {
            showInfo($(document).width(), param_app_name, param_tel, param_app_email, param_desc);
          }
        },
        error: function(data) {

        }
      });
    } else {
      showInfo($(document).width());
    }

  });

  function deleteTargetImg(width) {
    if (width <= 767) {
      $('.delete-target-img').each(function(index, value) {
        $(value).css('display', 'none');
      });
    } else {
      $('.delete-target-img').each(function(index, value) {
        $(value).css('display', 'inline-block');
      });
    }
  }

  function showInfo(width, app_name, tel, app_email, desc) {
    if (width > 1200) {
      $('.content-0').css('margin-top', '100px');
      $('.content-3').css('transform', 'translateY(-73%)');
    } else if(width >= 787 ) {
      $('.content-0').css('margin-top', '100px');
    } else if(width >= 320) {
      $('.content').css('top',$('.info').height()+20+"px");
    }

    if(!isNullOrUndefined(app_name) && !isNullOrUndefined(tel) && !isNullOrUndefined(app_email) && !isNullOrUndefined(desc)) {
      $('.user-profile .text').text(app_name);
      $('.action-icon a').attr('href', "tel:"+tel)
      $('.user-profile .sub-text').text(desc);
    }

    $('.edit-info').fadeOut(300).css('display', 'none');
    $('.info').fadeIn(300).css('display', 'block');
  }

  function showEditInfo(width) {
    if (width > 1200) {
      $('.content-0').css('margin-top', '197px');
      $('.content-3').css('transform', 'translateY(-47%)');
    } else if(width >= 787 ) {
      $('.content-0').css('margin-top', '186px');
    } else if(width >= 320) {
      $('.content').css('top', '360px');
    }
    $('.info').fadeOut(300).css('display', 'none');
    $('.edit-info').fadeIn(300).css('display', 'block');
  }

  function isNullOrUndefined(variable) { return variable === null || variable === undefined; }
</script>