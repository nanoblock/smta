<div class="modal fade" id="userModal" role="dialog">
    <!-- <div class="modal-dialog"> -->
    
      <div class="modal-content">
        <div class="bg"></div>
        <div class="modal-header">
          <%= image_tag '/assets/landing/usermodal/close.svg', class: 'close', data: {dismiss: 'modal'} %>
        </div>
        <div class="modal-body">
          <%= image_tag '/assets/landing/logo.svg', class: 'logo' %>

          <div class="regist-login">
            <div class="title">
              <div class="regist">
                <%= image_tag '/assets/landing/usermodal/regist.svg', id: 'regist-image' %>
                회원가입
              </div>
              <div class="login">
              <%= image_tag '/assets/landing/usermodal/login.svg', id: 'login-image' %>
                로그인
              </div>
            </div>
            <div class="body">
              <div class="modal-regist">
                <%= simple_form_for(resource, as: resource_name, url: registration_path(resource_name), id: 'regist-form') do |f| %>
                  <!-- <= f.error_notification %> -->
                  <div class="email-form">
                    <%= f.input :email, required: true, autofocus: true, label: false, placeholder: "이메일 입력", input_html: { class: "regist-email", autocomplete: 'off' } %>
                    <%= image_tag '/assets/landing/usermodal/email.svg', class: 'regist-email-img' %>
                  </div>
                  <div class="email-form-error">이메일을 정확히 입력해 주세요.</div>
                  <div class="pw-form">
                    <%= f.input :password, required: true, label: false, placeholder: "비밀번호 입력", input_html: { class: "regist-pw" }%>
                    <%= image_tag '/assets/landing/usermodal/password.svg', class: 'regist-pw-img' %>
                  </div>
                  <div class="pw-form-error">비밀번호는 4글자 이상, 숫자를 포함하여 만들어주세요.</div>

                  <div class="email-check-form">
                    <%= f.check_box :email_check, checked: true %>
                    <label><span></span>이메일 수신 동의</label>
                    이용약관
                  </div>
                  <div class="email-check-text">
                    - 동의를 하시면 댜양한 쇼미더앱스의 안내를 받아보실 수 있습니다.
                  </div>
                  <!-- <= f.input :password_confirmation, required: true %> -->
                  
              </div>
              <!-- <div class=""> -->
              <%= f.button :submit, "확인", class: 'submit-regist-btn' %>
              <!-- 확인 -->
              <% end %>
              <!-- </div> -->
              

              <div class="modal-login">
                <%= simple_form_for(resource, as: resource_name, format: :json, remote: true, url: session_path(resource_name), id: 'login-form') do |f| %>
                <div class="email-form">
                  <%= f.input :email, required: true, autofocus: true, label: false, placeholder: "이메일 입력", input_html: { class: "login-email", autocomplete: 'off'} %>
                  <%= image_tag '/assets/landing/usermodal/email.svg', class: 'login-email-img' %>
                </div>
                <div class="email-form-error">이메일을 정확히 입력해 주세요.</div>
                <div class="pw-form">
                  <%= f.input :password, required: true, label: false, placeholder: "비밀번호 입력", input_html: { class: "login-pw"} %>
                  <%= image_tag '/assets/landing/usermodal/password.svg', class: 'login-pw-img' %>
                </div>
                <div class="pw-form-error"></div>
                <div class="autologin-check-form">
                  <%= f.check_box :remember_me, checked: false, label: false, as: :boolean if devise_mapping.rememberable? %>
                  <label><span></span>자동 로그인</label>
                  비밀번호 변경
                </div>
              </div>
              <!-- <div class="">
                확인
                
              </div> -->
              <%= f.button :submit, "확인", class: 'submit-login-btn' %>
              <% end %>
              
            </div>
            
            
            
          </div>

        </div>
        <div class="modal-footer">
            
          <!-- <button type="button" class="btn btn-default" data-dismiss="modal">Close</button> -->
        </div>
      </div>
      
    <!-- </div> -->
  </div>

  <script>
  $(".userModal").click(function(e){
    e.preventDefault();
    styleType($(this).attr('id'));
    $("#userModal").modal();
  });

  $('.regist').on('click', function(e) {
    styleType('regist');
  });

  $('.login').on('click', function(e) {
    styleType('login');
  });

  function styleType(id) {
    if(id === 'regist') {
      styleRegistTitle();
      $('.modal-regist').css('display', 'block');
      $('.modal-login').css('display', 'none');
      $('.submit-regist-btn').css('display', 'block');
      $('.submit-login-btn').css('display', 'none');
    } else if(id === 'login') {
      styleLoginTitle();
      $('.modal-regist').css('display','none');
      $('.modal-login').css('display', 'block');
      $('.submit-regist-btn').css('display', 'none');
      $('.submit-login-btn').css('display', 'block');
    }
    setTimeout(function() {
        $("[autofocus]").focus(); 
      }, 500);
  }

  function styleRegistTitle() {
    $('.regist').css({
        'border-color': '#ffac48',
        'color': '#ffac48',
        'background-color': '#FFFFFF'
      });
      $('.login').css({
        'border-color': 'transparent',
        'color': '#FFFFFF',
        'background-color': '#D8D8D8'
      });
      $('#regist-image').attr('src', '/assets/landing/usermodal/regist_on.svg');
      $('#login-image').attr('src', '/assets/landing/usermodal/login.svg');
  }

  function styleLoginTitle() {
    $('.regist').css({
        'border-color': 'transparent',
        'color': '#FFFFFF',
        'background-color': '#D8D8D8'
      });
      $('.login').css({
        'border-color': '#ffac48',
        'color': '#ffac48',
        'background-color': '#FFFFFF'
      });
      $('#regist-image').attr('src', '/assets/landing/usermodal/regist.svg');
      $('#login-image').attr('src', '/assets/landing/usermodal/login_on.svg');
  }

  $('#userModal').on('show.bs.modal', function(){
      $(".email-form-error").css('visibility', 'hidden');
      $(".pw-form-error").css('visibility', 'hidden');

      $('.regist-email').val('');
      $('.regist-pw').val('');
      $('.regist-email-img').attr('src', '/assets/landing/usermodal/email.svg');
      $('.regist-pw-img').attr('src', '/assets/landing/usermodal/password.svg');

      $('.login-email').val('');
      $('.login-pw').val('');
      $('.login-email-img').attr('src', '/assets/landing/usermodal/email.svg');
      $('.login-pw-img').attr('src', '/assets/landing/usermodal/password.svg');
    });

  

  $(document).ready(function(){
    var RegexEmail = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/i; //이메일 요휴성검사
    var RegexPw = /^[a-zA-Z0-9._-]{4,30}$/;

    $('.submit-regist-btn').on('click', function(event) {
      if ( !RegexEmail.test($.trim($(".modal-regist .regist-email").val())) && !RegexPw.test($.trim($(".regist-pw").val())) ) {
        $(".modal-regist .email-form-error").css('visibility', 'visible');
        $(".modal-regist .pw-form-error").css('visibility', 'visible');
        // $(".modal-regist .email-form-error").effect( 'highlight', {color: 'rgba(245, 133, 31, 0.3)'}, 500, null );
        // $(".modal-regist .pw-form-error").effect( 'highlight', {color: 'rgba(245, 133, 31, 0.3)'}, 500, null );
        $('.modal-regist .regist-email-img').attr('src', '/assets/landing/usermodal/email_error.svg');
        $('.modal-regist .regist-pw-img').attr('src', '/assets/landing/usermodal/password_error.svg');
        $(".modal-regist .regist-email").focus();
        return false;
      } else if(!RegexEmail.test($.trim($(".modal-regist .regist-email").val()))) {
        $(".modal-regist .email-form-error").css('visibility', 'visible');
        $(".modal-regist .pw-form-error").css('visibility', 'hidden');
        // $(".modal-regist .email-form-error").effect( 'highlight', {color: 'rgba(245, 133, 31, 0.3)'}, 500, null );
        $('.modal-regist .regist-email-img').attr('src', '/assets/landing/usermodal/email_error.svg');
        $('.modal-regist .regist-email-img').attr('src', '/assets/landing/usermodal/password.svg');
        $(".modal-regist .regist-email").focus();
        return false;      
      } else if(!RegexPw.test($.trim($(".modal-regist .regist-pw").val()))) {
        $(".modal-regist .email-form-error").css('visibility', 'hidden');
        $(".modal-regist .pw-form-error").css('visibility', 'visible');
        // $(".modal-regist .pw-form-error").effect( 'highlight', {color: 'rgba(245, 133, 31, 0.3)'}, 500, null );
        $('.modal-regist .regist-email-img').attr('src', '/assets/landing/usermodal/email.svg');
        $('.modal-regist .regist-pw-img').attr('src', '/assets/landing/usermodal/password_error.svg');
        $(".modal-regist .regist-pw").focus();
        return false;
      }
    });

    $('.submit-login-btn').on('click', function(event) {
      // if(!RegexEmail.test($.trim($('modal-login .login-email').val()))) {
      //   $('.modal-login .email-form-error').text('이메일을 정확히 입력해 주세요.').css('visibility', 'visible');
      //   $('.modal-login .pw-form-error').css('visibility', 'hidden');
      //   // $(".modal-login .pw-form-error").effect( 'highlight', {color: 'rgba(245, 133, 31, 0.3)'}, 500, null );
      //   $('.modal-login .login-email-img').attr('src', '/assets/landing/usermodal/email_error.svg');
      //   $('.modal-login .login-pw-img').attr('src', '/assets/landing/usermodal/password.svg');
      //   $('.modal-login .login-email').val('').focus();
      //   return false
      // }

      if(!RegexPw.test($.trim($('.modal-login .login-pw').val()))) {
        $('.modal-login .email-form-error').css('visibility', 'hidden');
        $('.modal-login .pw-form-error').text('비밀번호는 4글자 이상, 숫자를 포함하여 만들어주세요.').css('visibility', 'visible');
        // $(".modal-login .pw-form-error").effect( 'highlight', {color: 'rgba(245, 133, 31, 0.3)'}, 500, null );
        $('.modal-login .login-email-img').attr('src', '/assets/landing/usermodal/email.svg');
        $('.modal-login .login-pw-img').attr('src', '/assets/landing/usermodal/password_error.svg');
        $('.modal-login .login-pw').focus();
        return false; 
      }

      $(document).bind('ajax:success', function(e, data, status, xhr) {
          window.location = '<%= root_path %>';
        })
      .bind("ajax:error", function(e, xhr, status, error) {
        if(xhr.responseText === 'Not exist email.') {
          $('.modal-login .email-form-error').text('존재하지 않는 이메일입니다.').css('visibility', 'visible');
          $('.modal-login .pw-form-error').css('visibility', 'hidden');
          $('.modal-login .login-email-img').attr('src', '/assets/landing/usermodal/email_error.svg');
          $('.modal-login .login-pw-img').attr('src', '/assets/landing/usermodal/password.svg');
          $(".modal-login .login-email").val('').focus(); 
          
          return false;
        } else if(xhr.responseText === 'Invalid password.') {
          $('.modal-login .email-form-error').css('visibility', 'hidden');
          $('.modal-login .pw-form-error').text('비밀번호가 틀렸습니다. 다시 입력해주세요.').css('visibility', 'visible');
          $('.modal-login .login-email-img').attr('src', '/assets/landing/usermodal/email.svg');
          $('.modal-login .login-pw-img').attr('src', '/assets/landing/usermodal/password_error.svg');
          $(".modal-login .login-pw").val('').focus(); 
          return false;
        }
        });
    });

  });

</script>